(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17a86463"],{"252b":function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"book-category"},[o("shelf-title",{ref:"shelfTitle",staticClass:"shelf-title",attrs:{title:t.category.title,isEditMode:t.isEditMode,ifShowBack:t.ifShowBack,ifShowClear:t.ifShowClear,ifGroupEmpty:t.isEmpty,data:t.bookList,category:t.category},on:{"update:isEditMode":function(e){t.isEditMode=e},"update:is-edit-mode":function(e){t.isEditMode=e},onEditClick:t.onEditClick,deleteGroup:t.deleteGroup,editGroupName:t.editGroupName}}),t.isEmpty?t._e():o("scroll-view",{ref:"scroll",staticClass:"book-shelf-scroll-wrapper",attrs:{top:42,bottom:t.scrollBottom},on:{onScroll:t.onScroll}},[o("book-shelf",{ref:"bookShelf",staticClass:"book-shelf-list",attrs:{data:t.category.itemList,isEditMode:t.isEditMode},on:{onBookClick:t.onBookClick}})],1),t.isEditMode&&!t.isEmpty?o("book-shelf-footer",{staticClass:"book-shelf-footer",attrs:{data:t.category.itemList,bookList:t.bookList,isInGroup:!0,category:t.category},on:{setPrivate:t.setPrivate,setDownload:t.setDownload,removeBook:t.removeBook,groupEdit:t.groupEdit}}):t._e(),o("toast",{ref:"toast",attrs:{text:t.toastText}}),t.isEmpty?o("div",{staticClass:"shelf-empty-view"},[o("span",{staticClass:"shelf-empty-text"},[t._v(t._s(t.$t("shelf.groupNone")))])]):t._e()],1)},s=[],n=o("fced"),r=n["a"],c=(o("86a4"),o("2877")),a=Object(c["a"])(r,i,s,!1,null,"78708088",null);e["default"]=a.exports},"86a4":function(t,e,o){"use strict";o("9b37")},"9b37":function(t,e,o){},fced:function(t,e,o){"use strict";(function(t){o("96cf");var i=o("1da1"),s=(o("a481"),o("2909")),n=(o("ac6a"),o("ebe4")),r=o("9878"),c=o("4e1b"),a=o("cd05"),l=o("ad72"),h=o("e8ec"),f=o("101f"),u=o("b067"),d=o("a211");t.ePub=d["a"];var k="bookShelf";e["a"]={components:{ShelfTitle:n["a"],ScrollView:c["a"],BookShelf:r["a"],BookShelfFooter:a["a"],Toast:l["a"]},computed:{isEmpty:function(){return!(this.category&&this.category.itemList&&this.category.itemList.length>0)}},data:function(){return{index:null,bookList:[],category:{},isEditMode:!1,ifShowBack:!0,ifShowClear:!1,scrollBottom:0,toastText:""}},methods:{editGroupName:function(t,e){t.title=e,this.onEditClick(!1),this.saveBookShelfToLocalStorage()},deleteGroup:function(t){var e=this.getBooksFromCategory(t);this.removeCategory(t),this.clearAddFromBookList(),this.appendBookToList(e),this.appendAddToBookList(),this.onEditClick(!1),this.saveBookShelfToLocalStorage(),this.$router.go(-1)},removeCategory:function(t){this.bookList=this.bookList.filter((function(e){return t.id!==e.id}))},getBooksFromCategory:function(t){return t.itemList},groupEdit:function(t,e){switch(t){case 1:this.moveToGroup(e);break;case 2:this.newGroup(e),this.moveToGroup(e);break;case 3:this.moveOutGroup();break}},getSelectedBooks:function(){var t=this.bookList.filter((function(t){return t.selected}));return this.bookList.filter((function(e){2===e.type&&e.itemList&&e.itemList.filter((function(e){e.selected&&t.push(e)}))})),t},clearSelectedBooks:function(){this.bookList=this.bookList.filter((function(t){return!t.selected})),this.bookList.forEach((function(t){2===t.type&&t.itemList&&(t.itemList=t.itemList.filter((function(t){return!t.selected})))}))},appendBookToList:function(t){var e=this,o=this.bookList[this.bookList.length-1].id+1;t.forEach((function(t){t.id=o++,e.bookList.push(t)}))},moveOutGroup:function(){this.clearAddFromBookList();var t=this.getSelectedBooks();this.clearSelectedBooks(),this.appendBookToList(t),this.appendAddToBookList(),this.onEditClick(!1),this.saveBookShelfToLocalStorage(),this.showToast(this.$t("shelf.moveBookOutSuccess"))},newGroup:function(t){this.clearAddFromBookList(),this.bookList.push(t),this.appendAddToBookList()},moveToGroup:function(t){var e=this.getSelectedBooks();this.clearSelectedBooks(),t&&t.itemList&&(t.itemList=[].concat(Object(s["a"])(t.itemList),Object(s["a"])(e)),t.itemList.forEach((function(t,e){t.id=e+1}))),this.onEditClick(!1),this.saveBookShelfToLocalStorage(),this.showToast(this.$t("shelf.moveBookInSuccess").replace("$1",t.title))},appendAddToBookList:function(){this.bookList.push({cover:"",title:"",type:3,id:this.bookList[this.bookList.length-1].id+1})},clearAddFromBookList:function(){this.bookList=this.bookList.filter((function(t){return 3!==t.type}))},removeBook:function(){this.bookList=this.bookList.filter((function(t){return t.itemList&&(t.itemList=t.itemList.filter((function(t){return!t.selected}))),!t.selected})),this.onEditClick(!1),this.saveBookShelfToLocalStorage()},onBookClick:function(t,e){this.$router.push({path:"/book-store/detail",query:{fileName:t.fileName,category:t.categoryText}})},showToast:function(t){this.toastText=t,this.$refs.toast.show()},removeDownloadBook:function(t){return new Promise((function(e,o){Object(f["c"])(t.fileName,(function(){console.log("[".concat(t.fileName,"]删除成功...")),e()}),o)}))},downloadBook:function(t){return new Promise((function(e,o){Object(f["b"])(t.fileName,(function(i,s){!i&&s instanceof Blob?(console.log("[".concat(t.fileName,"]读取成功..."),s,new d["a"](s)),e()):Object(u["b"])(t,(function(t){console.log("["+t.fileName+"]下载成功..."),e()}),o,o)}))}))},setDownload:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var o,i,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e?this.showToast(this.$t("shelf.setDownloadSuccess")):this.showToast(this.$t("shelf.removeDownloadSuccess")),o=regeneratorRuntime.mark((function t(o){var i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=s.bookList[o],!e||!i.selected){t.next=7;break}return console.log("item-正在处理第".concat(o+1,"本书")),t.next=5,s.downloadBook(i).then((function(){i.cache=e}));case 5:t.next=11;break;case 7:if(e||!i.selected){t.next=11;break}return console.log("item-正在处理第".concat(o+1,"本书")),t.next=11,s.removeDownloadBook(i).then((function(){i.cache=e}));case 11:if(!i.itemList){t.next=19;break}n=0;case 13:if(!(n<i.itemList.length)){t.next=19;break}return t.next=16,s.downloadItem(i.itemList[n],e);case 16:n++,t.next=13;break;case 19:case"end":return t.stop()}}),t)})),i=0;case 3:if(!(i<this.bookList.length)){t.next=8;break}return t.delegateYield(o(i),"t0",5);case 5:i++,t.next=3;break;case 8:this.onEditClick(!1),this.saveBookShelfToLocalStorage(),console.log("数据保存成功...");case 11:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),downloadItem:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,o){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("subItem-正在处理".concat(e.fileName)),!o||!e.selected){t.next=6;break}return t.next=4,this.downloadBook(e).then((function(){e.cache=o}));case 4:t.next=9;break;case 6:if(o||!e.selected){t.next=9;break}return t.next=9,this.removeDownloadBook(e).then((function(){e.cache=o}));case 9:case"end":return t.stop()}}),t,this)})));function e(e,o){return t.apply(this,arguments)}return e}(),setPrivate:function(t){this.bookList.forEach((function(e){e.selected&&(e.private=t),e.itemList&&e.itemList.forEach((function(e){e.selected&&(e.private=t)}))})),this.onEditClick(!1),this.saveBookShelfToLocalStorage(),t?this.showToast(this.$t("shelf.setPrivateSuccess")):this.showToast(this.$t("shelf.closePrivateSuccess"))},onEditClick:function(t){var e=this;this.isEditMode=t,this.isEditMode||this.bookList.forEach((function(t){t.bookId?t.selected=!1:t.itemList&&t.itemList.forEach((function(t){t.selected=!1}))})),this.isEditMode?(this.scrollBottom=48,this.$nextTick((function(){e.$refs.scroll&&e.$refs.scroll.refresh()}))):(this.scrollBottom=0,this.$nextTick((function(){e.$refs.scroll&&e.$refs.scroll.refresh()})))},onScroll:function(t){t>0?this.$refs.shelfTitle.showShadow():this.$refs.shelfTitle.hideShadow()},getBookList:function(){this.bookList=this.getBookShelfFromLocalStorage()},getCategoryList:function(){this.index=this.$route.query.index,this.category=this.bookList[this.index],console.log(this.category)},saveBookShelfToLocalStorage:function(){Object(h["v"])(k,this.bookList)},getBookShelfFromLocalStorage:function(){return Object(h["f"])(k)}},mounted:function(){this.getBookList(),this.getCategoryList()}}}).call(this,o("c8ba"))}}]);