(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-590c571e"],{"1b65":function(t,e,o){},"773e":function(t,e,o){},"8cd5":function(t,e,o){"use strict";(function(t){o("96cf");var i=o("1da1"),s=(o("c5f6"),o("87f3"),o("a481"),o("2909")),a=(o("ac6a"),o("ebe4")),c=o("a2d0"),n=o("9878"),r=o("4e1b"),h=o("cd05"),l=o("b2c5"),f=o("ad72"),u=o("b067"),d=o("e8ec"),k=o("101f"),p=o("5de6"),w=o("a211"),m=o("fa7d");t.ePub=w["a"];var b="bookShelf";e["a"]={components:{ShelfTitle:a["a"],ShelfSearch:c["a"],BookShelf:n["a"],ScrollView:r["a"],BookShelfFooter:h["a"],BookShelfEmpty:l["a"],Toast:f["a"]},computed:{isDataEmpty:function(){return!this.bookList||0===this.bookList.filter((function(t){return 3!==t.type})).length}},data:function(){return{bookList:[],ifShowTitle:!0,isEditMode:!1,ifShowBack:!1,ifShowClear:!0,scrollBottom:0,toastText:"",showType:0,initPosition:{x:0,y:0}}},methods:{onSearchTabClick:function(t){this.showType=t},groupEdit:function(t,e){switch(t){case 1:this.moveToGroup(e);break;case 2:this.newGroup(e),this.moveToGroup(e);break;case 3:this.moveOutGroup();break}},getSelectedBooks:function(){var t=this.bookList.filter((function(t){return t.selected}));return this.bookList.filter((function(e){2===e.type&&e.itemList&&e.itemList.filter((function(e){e.selected&&t.push(e)}))})),t},clearSelectedBooks:function(){this.bookList=this.bookList.filter((function(t){return!t.selected})),this.bookList.forEach((function(t){2===t.type&&t.itemList&&(t.itemList=t.itemList.filter((function(t){return!t.selected})))}))},appendBookToList:function(t){var e=this,o=this.bookList[this.bookList.length-1].id+1;t.forEach((function(t){t.id=o++,e.bookList.push(t)}))},moveOutGroup:function(){this.clearAddFromBookList();var t=this.getSelectedBooks();this.clearSelectedBooks(),this.appendBookToList(t),this.appendAddToBookList(),this.onEditClick(!1),this.saveBookShelfToLocalStorage(),this.showToast(this.$t("shelf.moveBookOutSuccess"))},newGroup:function(t){this.clearAddFromBookList(),this.bookList.push(t),this.appendAddToBookList()},moveToGroup:function(t){var e=this.getSelectedBooks();this.clearSelectedBooks(),t&&t.itemList&&(t.itemList=[].concat(Object(s["a"])(t.itemList),Object(s["a"])(e)),t.itemList.forEach((function(t,e){t.id=e+1}))),this.onEditClick(!1),this.saveBookShelfToLocalStorage(),this.showToast(this.$t("shelf.moveBookInSuccess").replace("$1",t.title))},appendAddToBookList:function(){this.bookList.push({cover:"",title:"",type:3,id:Number.MAX_SAFE_INTEGER})},clearAddFromBookList:function(){this.bookList=this.bookList.filter((function(t){return 3!==t.type}))},removeBook:function(){this.bookList=this.bookList.filter((function(t){return t.itemList&&(t.itemList=t.itemList.filter((function(t){return!t.selected}))),!t.selected})),this.onEditClick(!1),this.saveBookShelfToLocalStorage()},clearCache:function(){var t=this;Object(d["a"])(),Object(k["a"])((function(){console.log("清除localForage成功..."),t.getBookShelf()})),this.showToast(this.$t("shelf.clearCacheSuccess"))},onBookClick:function(t,e){this.$router.push({path:"/book-store/detail",query:{fileName:t.fileName,category:t.categoryText}})},showToast:function(t){this.toastText=t,this.$refs.toast.show()},hideToast:function(){this.$refs.toast.hide()},showContinueToast:function(t){this.toastText=t,this.$refs.toast.continueShow()},removeDownloadBook:function(t){return Object(p["j"])(t.fileName)},downloadBook:function(t){var e=this;return new Promise((function(o,i){Object(k["b"])(t.fileName,(function(s,a){!s&&a instanceof Blob?(console.log("[".concat(t.fileName,"]读取成功..."),a,new w["a"](a)),o()):Object(u["b"])(t,(function(t){console.log("["+t.fileName+"]下载成功..."),o()}),i,i,(function(o){var i=Math.floor(o.loaded/o.total*100)+"%";e.toastText=e.$t("shelf.progressDownload").replace("$1","".concat(t.fileName,".epub(").concat(i,")"))}))}))}))},setDownload:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var o,i,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.showContinueToast(this.$t("shelf.startDownload")),o=regeneratorRuntime.mark((function t(o){var i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=s.bookList[o],!e||!i.selected){t.next=6;break}return t.next=4,s.downloadBook(i).then((function(){i.cache=e}));case 4:t.next=9;break;case 6:if(e||!i.selected){t.next=9;break}return t.next=9,s.removeDownloadBook(i).then((function(){i.cache=e}));case 9:if(!i.itemList){t.next=17;break}a=0;case 11:if(!(a<i.itemList.length)){t.next=17;break}return t.next=14,s.downloadItem(i.itemList[a],e);case 14:a++,t.next=11;break;case 17:case"end":return t.stop()}}),t)})),i=0;case 3:if(!(i<this.bookList.length)){t.next=8;break}return t.delegateYield(o(i),"t0",5);case 5:i++,t.next=3;break;case 8:this.hideToast(),e?this.showToast(this.$t("shelf.setDownloadSuccess")):this.showToast(this.$t("shelf.removeDownloadSuccess")),this.onEditClick(!1),this.saveBookShelfToLocalStorage(),console.log("数据保存成功...");case 13:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),downloadItem:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,o){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!o||!e.selected){t.next=5;break}return t.next=3,this.downloadBook(e).then((function(){e.cache=o}));case 3:t.next=8;break;case 5:if(o||!e.selected){t.next=8;break}return t.next=8,this.removeDownloadBook(e).then((function(){e.cache=o}));case 8:case"end":return t.stop()}}),t,this)})));function e(e,o){return t.apply(this,arguments)}return e}(),setPrivate:function(t){this.bookList.forEach((function(e){e.selected&&(e.private=t)})),this.onEditClick(!1),this.saveBookShelfToLocalStorage(),t?this.showToast(this.$t("shelf.setPrivateSuccess")):this.showToast(this.$t("shelf.closePrivateSuccess"))},onEditClick:function(t){var e=this;this.isEditMode=t,this.isEditMode||this.bookList.forEach((function(t){t.bookId?t.selected=!1:t.itemList&&t.itemList.forEach((function(t){t.selected=!1}))})),this.isEditMode?(this.scrollBottom=48,this.$nextTick((function(){e.$refs.scroll&&e.$refs.scroll.refresh()}))):(this.scrollBottom=0,this.$nextTick((function(){e.$refs.scroll&&e.$refs.scroll.refresh()})))},onSearchClick:function(){this.onEditClick(!1),this.showType=1,this.hideTitle()},onSearchCancel:function(){this.showTitle(),this.showType=0,this.$refs.scroll.scrollTo(0,0)},showTitle:function(){this.ifShowTitle=!0},hideTitle:function(){this.ifShowTitle=!1},onScroll:function(t){t>Object(m["d"])(54)?(this.$refs.shelfTitle.showShadow(),this.ifShowTitle||this.$refs.shelfSearch.showShadow()):(this.$refs.shelfTitle.hideShadow(),this.$refs.shelfSearch&&this.$refs.shelfSearch.hideShadow())},getBookShelf:function(){var t=this;this.bookList=this.getBookShelfFromLocalStorage(),this.bookList||Object(u["f"])().then((function(e){t.bookList=e.data.bookList,t.bookList||(t.bookList=[]),t.appendAddToBookList(),t.saveBookShelfToLocalStorage(),t.initBookShelf()})),this.initBookShelf()},initBookShelf:function(){this.bookList&&this.bookList.forEach((function(t){t.selected=!1}))},saveBookShelfToLocalStorage:function(){Object(d["v"])(b,this.bookList)},getBookShelfFromLocalStorage:function(){return Object(d["f"])(b)}},mounted:function(){this.getBookShelf()}}}).call(this,o("c8ba"))},"960d":function(t,e,o){"use strict";o("1b65")},a2d0:function(t,e,o){"use strict";var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"shelf-search-wrapper",class:{"search-top":t.ifShowCancel,"hide-shadow":t.ifHideShadow}},[o("div",{staticClass:"shelf-search",class:{"search-top":t.ifShowCancel}},[o("div",{staticClass:"search-wrapper"},[t._m(0),o("div",{staticClass:"search-input-wrapper"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],ref:"searchInput",staticClass:"search-input",attrs:{type:"text",placeholder:t.$t("shelf.search")},domProps:{value:t.searchText},on:{input:[function(e){e.target.composing||(t.searchText=e.target.value)},t.checkSearchText],click:t.onSearchClick}})]),t.ifShowClear?o("div",{staticClass:"icon-clear-wrapper",on:{click:t.clearSearchText}},[o("span",{staticClass:"icon-close-circle-fill icon"})]):t._e()]),t.ifShowCancel?o("div",{staticClass:"cancel-btn-wrapper",on:{click:t.onCancel}},[o("span",{staticClass:"cancel-btn"},[t._v(t._s(t.$t("shelf.cancel")))])]):o("div",{staticClass:"icon-clock-wrapper",on:{click:t.showReadHistory}},["cn"===t.lang()?o("span",{staticClass:"icon-cn icon"}):o("span",{staticClass:"icon-en icon"})])]),o("transition",{attrs:{name:"shelf-tab-slide-up"}},[t.ifShowCancel?o("div",{staticClass:"tab-wrapper"},t._l(t.tabs,(function(e,i){return o("div",{key:i,staticClass:"tab-item",on:{click:function(o){return t.onTabClick(e)}}},[t.showShadow?o("span",{staticClass:"tab-item-text",class:{"is-selected":e.selected}},[t._v(t._s(e.text))]):t._e()])})),0):t._e()])],1)},s=[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"icon-search-wrapper"},[o("span",{staticClass:"icon-search icon"})])}],a=(o("ac6a"),o("5de6")),c=o("e8ec"),n={computed:{tabs:function(){return[{id:1,text:this.$t("shelf.default"),selected:!0},{id:2,text:this.$t("shelf.progress"),selected:!1},{id:3,text:this.$t("shelf.purchase"),selected:!1}]}},data:function(){return{ifShowCancel:!1,ifShowClear:!1,ifHideShadow:!0,searchText:""}},methods:{lang:function(){return Object(c["f"])("locale")},showReadHistory:function(){Object(a["n"])(this)},onTabClick:function(t){this.tabs.forEach((function(e){e.id===t.id?e.selected=!0:e.selected=!1})),this.$emit("onTabClick",t.id),this.$forceUpdate()},showShadow:function(){this.ifHideShadow=!1},hideShadow:function(){this.ifHideShadow=!0},onCancel:function(){this.$emit("onCancel"),this.ifShowCancel=!1},clearSearchText:function(){this.searchText="",this.checkSearchText(),this.$refs.searchInput.focus()},checkSearchText:function(){this.searchText&&this.searchText.length>0?this.ifShowClear=!0:this.ifShowClear=!1},onSearchClick:function(){this.$emit("onSearchClick"),this.ifShowCancel=!0}}},r=n,h=(o("e042"),o("2877")),l=Object(h["a"])(r,i,s,!1,null,"62878840",null);e["a"]=l.exports},b293:function(t,e,o){t.exports=o.p+"img/imooc.61a8d7f6.jpeg"},b2c5:function(t,e,o){"use strict";var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"emptyView",staticClass:"book-shelf-empty-wrapper"},[o("div",{staticClass:"empty-img-wrapper"},[o("img",{staticClass:"empty-img",attrs:{src:t.img}})]),o("div",{staticClass:"empty-text-wrapper"},[o("div",{staticClass:"empty-text",domProps:{innerHTML:t._s(t.$t("shelf.welcome"))}})]),o("div",{staticClass:"empty-btn-wrapper"},[o("div",{staticClass:"empty-btn",on:{click:t.gotoStudy}},[t._v(t._s(t.$t("shelf.studyNow")))]),o("div",{staticClass:"empty-btn",on:{click:t.gotoBookStore}},[t._v(t._s(t.$t("shelf.find")))])])])},s=[],a=o("fa7d"),c={data:function(){return{img:o("b293")}},methods:{gotoBookStore:function(){this.$router.push("/book-store/home")},gotoStudy:function(){window.location.href="https://coding.imooc.com/class/285.html"}},mounted:function(){this.$refs.emptyView.style.height=window.innerHeight-Object(a["d"])(42)+"px"}},n=c,r=(o("ea89"),o("2877")),h=Object(r["a"])(n,i,s,!1,null,"80af3aa0",null);e["a"]=h.exports},d05c:function(t,e,o){},dff4:function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"book-shelf"},[o("shelf-title",{directives:[{name:"show",rawName:"v-show",value:t.ifShowTitle,expression:"ifShowTitle"}],ref:"shelfTitle",staticClass:"shelf-title",attrs:{title:t.$t("shelf.title"),isEditMode:t.isEditMode,data:t.bookList,ifShowBack:t.ifShowBack,ifShowClear:t.ifShowClear},on:{"update:isEditMode":function(e){t.isEditMode=e},"update:is-edit-mode":function(e){t.isEditMode=e},onEditClick:t.onEditClick,clearCache:t.clearCache}}),o("scroll-view",{ref:"scroll",staticClass:"book-shelf-scroll-wrapper",attrs:{top:0,bottom:t.scrollBottom,initPosition:t.initPosition},on:{onScroll:t.onScroll}},[t.isDataEmpty?t._e():o("shelf-search",{ref:"shelfSearch",on:{onSearchClick:t.onSearchClick,onCancel:t.onSearchCancel,onTabClick:t.onSearchTabClick}}),t.isDataEmpty?t._e():o("book-shelf",{ref:"bookShelf",staticClass:"book-shelf-list",attrs:{data:t.bookList,showType:t.showType,isEditMode:t.isEditMode},on:{onBookClick:t.onBookClick}}),t.isDataEmpty?o("book-shelf-empty",{staticClass:"book-shelf-empty"}):t._e()],1),o("book-shelf-footer",{directives:[{name:"show",rawName:"v-show",value:t.isEditMode,expression:"isEditMode"}],staticClass:"book-shelf-footer",attrs:{data:t.bookList,bookList:t.bookList,isInGroup:!1},on:{setPrivate:t.setPrivate,setDownload:t.setDownload,removeBook:t.removeBook,groupEdit:t.groupEdit}}),o("toast",{ref:"toast",attrs:{text:t.toastText}})],1)},s=[],a=o("8cd5"),c=a["a"],n=(o("960d"),o("2877")),r=Object(n["a"])(c,i,s,!1,null,"fea5b944",null);e["default"]=r.exports},e042:function(t,e,o){"use strict";o("773e")},ea89:function(t,e,o){"use strict";o("d05c")}}]);